# ğŸŒ‘ NOVA Systems // FPV

**Advanced Real-time Image Enhancement Camera for Android**

NOVAã¯ã€Androidå‘ã‘ã®é«˜åº¦ãªFPVï¼ˆä¸€äººç§°è¦–ç‚¹ï¼‰ã‚«ãƒ¡ãƒ©ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚  
OpenGL ES 3.0ã«ã‚ˆã‚‹ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ´»ç”¨ã—ã€**Retinexç†è«–ã«åŸºã¥ã„ãŸç‹¬è‡ªã®ç”»åƒå¼·èª¿ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å®Ÿè¡Œã—ã¾ã™ã€‚  
æš—æ‰€ã‚„ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãªç’°å¢ƒä¸‹ã§ã®è¦–èªæ€§ã‚’åŠ‡çš„ã«å‘ä¸Šã•ã›ã‚‹ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

---

## âš¡ ä¸»ãªæ©Ÿèƒ½ (Key Features)

- **ğŸ‘ï¸ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç”»åƒå¼·èª¿ (Retinex Enhancement)**
  - ç‹¬è‡ªã®GLSLã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã«ã‚ˆã‚Šã€æ˜ åƒã®ã€Œç…§æ˜æˆåˆ†ï¼ˆIlluminationï¼‰ã€ã¨ã€Œåå°„ç‡æˆåˆ†ï¼ˆReflectanceï¼‰ã€ã‚’åˆ†é›¢ã€‚
  - ã‚¬ãƒ³ãƒè£œæ­£ã¨ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°ã‚’ç”¨ã„ãŸãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ãƒ¬ãƒ³ã‚¸åœ§ç¸®ã«ã‚ˆã‚Šã€ç™½é£›ã³ã‚’æŠ‘ãˆã¤ã¤æš—éƒ¨ã‚’å¯è¦–åŒ–ã€‚
- **ğŸ–¥ï¸ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ»ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**
  - **Jetpack Compose**: ãƒ¢ãƒ€ãƒ³ã§å®£è¨€çš„ãªUIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã‚‹HUDï¼ˆHead-Up Displayï¼‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã€‚
  - **OpenGL ES 3.0**: `GLSurfaceView` ã‚’ç”¨ã„ãŸé«˜é€Ÿãªæ˜ åƒå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€‚
  - Composeã® `AndroidView` å†…ã§GLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«å‹•ä½œã€‚
- **ğŸ”Œ å°†æ¥çš„ãªæ‹¡å¼µæ€§**
  - C++ (JNI) é€£æºã®åŸºç›¤ã‚’å®Ÿè£…æ¸ˆã¿ï¼ˆ`native-lib.cpp`ï¼‰ã€‚
  - USBã‚«ãƒ¡ãƒ© (UVC) æ¥ç¶šã‚„é«˜åº¦ãªç”»åƒå‡¦ç†ã¸ã®æ‹¡å¼µã‚’æƒ³å®šã—ãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‚
- **ğŸ•¶ï¸ æ²¡å…¥å‹ãƒ¢ãƒ¼ãƒ‰**
  - ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚’éš ã—ã€ç”»é¢å…¨ä½“ã‚’ä½¿ç”¨ã—ãŸImmersive Modeã‚’ã‚µãƒãƒ¼ãƒˆã€‚

---

## ğŸ›  æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ (Tech Stack)

- **Language**: Kotlin, C++ (JNI), GLSL
- **UI Framework**: Jetpack Compose (Material3)
- **Graphics API**: OpenGL ES 3.0 (`GLSurfaceView`)
- **Architecture**: Single Activity + Navigation Compose
- **Permissions**: Camera, Record Audio, USB Host

---

## ğŸ¨ ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯ (Retinex Algorithm)

NOVAã®ç”»åƒå‡¦ç†ã‚³ã‚¢ã¯ `retinex_shader.glsl` ã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

1. **Luminance Estimation**: å…¥åŠ›ç”»åƒã®è¼åº¦æˆåˆ† Y ã‚’ç®—å‡º  
2. **Blur Approximation**: 9-tap Box Blur ã«ã‚ˆã‚Šç…§æ˜æˆåˆ† L ã‚’æ¨å®š  
3. **Reflectance Calculation**: `R = Y / L` ã«ã‚ˆã‚Šåå°„ç‡ã‚’æŠ½å‡º  
4. **Highlight Protection**: ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°ã§ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æŠ‘åˆ¶  
5. **Gamma Correction**: å‡ºåŠ›ã«ã‚¬ãƒ³ãƒè£œæ­£ã‚’é©ç”¨  

```glsl
// Shader Snippet
float R = Y / L;               // Reflectance
float s = clamp(R, 0.5, 1.5);  // Scale
float w = 1.0 / (1.0 + exp((L - uBrightThresh) / uBrightK)); // Weight
```

---

## ğŸš€ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ“ãƒ«ãƒ‰

1. ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¾ã™ã€‚
2. Android Studio (Iguanaä»¥é™æ¨å¥¨) ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãã¾ã™ã€‚
3. NDK (Native Development Kit) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
4. å®Ÿæ©Ÿï¼ˆAndroid 8.0ä»¥ä¸Šæ¨å¥¨ï¼‰ã‚’æ¥ç¶šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

> ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ã¯ OpenGL ES 3.0 ã®å‹•ä½œãŒä¸å®‰å®šãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
app/src/main
â”œâ”€ cpp/
â”‚   â””â”€ native-lib.cpp        # JNI ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰
â”œâ”€ assets/
â”‚   â””â”€ shaders/
â”‚       â””â”€ retinex_shader.glsl
â””â”€ java/com/example/nova/
    â”œâ”€ ui/
    â”‚   â”œâ”€ VideoRenderer.kt  # OpenGL ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
    â”‚   â””â”€ HudOverlay.kt     # HUD (Compose)
    â””â”€ MainActivity.kt       # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

---

## âš ï¸ æ³¨æ„äº‹é …

- æœ¬ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‰ˆ** ã§ã™ã€‚
- USBã‚«ãƒ¡ãƒ©æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯ã¯ç¾åœ¨TODOçŠ¶æ…‹ã§ã™ã€‚
- ç”»åƒå¼·èª¿ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆSigma, Gamma ç­‰ï¼‰ã¯ `VideoRenderer.kt` å†…ã§èª¿æ•´å¯èƒ½ã§ã™ã€‚
